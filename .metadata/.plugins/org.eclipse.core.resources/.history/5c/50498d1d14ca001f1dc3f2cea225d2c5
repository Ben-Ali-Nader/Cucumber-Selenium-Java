package Pages;

import java.io.IOException;
import java.time.Duration;
import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.interactions.Actions;
import org.openqa.selenium.support.FindBy;
import org.openqa.selenium.support.PageFactory;
import org.openqa.selenium.support.pagefactory.AjaxElementLocatorFactory;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;

import com.aventstack.extentreports.MediaEntityBuilder;

import Utils.BaseTest;

public class JOly_Paris2024_Page {


	private WebDriver driver;
	private WebDriverWait wait;
	JavascriptExecutor js;


	@FindBy(id="menu-olympic-games")
	WebElement MenuOlympicGames;

	@FindBy(xpath="//*[@class=\"EditionsCarousel-styles__EditionTitle-sc-4c69da2b-4 dzehSP\" and contains (text(),'Paris 2024')]")
	WebElement paris2024;

	public JOly_Paris2024_Page(WebDriver driver) {
		this.driver = driver;
		this.wait = new WebDriverWait(driver, Duration.ofSeconds(10));
		PageFactory.initElements(new AjaxElementLocatorFactory(driver, 10), this);
	}


	public void verifyElementVisibility(WebElement element, String elementName) throws IOException {
		try {
			if (element.isDisplayed()) {
				BaseTest.test.pass("Le Message '" + elementName + "' est visible.");
			} else {
				BaseTest.test.fail("Le Message'" + elementName + "' n'est pas visible.");
			}
		} catch (Exception e) {
			BaseTest.test.fail("Erreur lors de la vérification de l'élément '" + elementName + "'.",
					MediaEntityBuilder.createScreenCaptureFromPath(BaseTest.takeScreenshot(elementName + "_visibility_error")).build());
		}
	}

	public void waitForPageToLoad() {
		WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(30)); // Temps d'attente maximum de 30 secondes
		JavascriptExecutor js = (JavascriptExecutor) driver;
		wait.until(webDriver -> js.executeScript("return document.readyState").toString().equals("complete"));
	}

	public void hoverMenuOlympique() throws IOException, InterruptedException {
		waitForPageToLoad();
		
	    boolean menuVisible = false;
	    int attempts = 0;

	    while (!menuVisible && attempts < 3) {
	        try {BaseTest.takeScreenshot("avant_hover");
	            Actions actions = new Actions(driver);
	            actions.moveToElement(MenuOlympicGames).perform();
	            wait.until(ExpectedConditions.visibilityOf(paris2024));
	            menuVisible = true;
	            BaseTest.takeScreenshot("apres_hover");
	        } catch (Exception e) {
	            attempts++;
	            Thread.sleep(1000); // Attendre avant de réessayer
	        }
	    }

	    if (!menuVisible) {
	        throw new IOException("Le menu olympique n'est pas apparu après plusieurs tentatives.");
	    }
	  

	}
	
	
	public void listAllIframes() {
	    List<WebElement> iframes = driver.findElements(By.tagName("iframe"));
	    System.out.println("Nombre de iframes sur la page : " + iframes.size());

	    for (int i = 0; i < iframes.size(); i++) {
	        WebElement iframe = iframes.get(i);

	        // Obtenez les attributs id, name et src de chaque iframe
	        String iframeId = iframe.getAttribute("id");
	        String iframeName = iframe.getAttribute("name");
	        String iframeSrc = iframe.getAttribute("src");

	        System.out.println("Iframe #" + (i + 1));
	        System.out.println("ID : " + (iframeId != null ? iframeId : "Non défini"));
	        System.out.println("Name : " + (iframeName != null ? iframeName : "Non défini"));
	        System.out.println("Source : " + (iframeSrc != null ? iframeSrc : "Non défini"));
	        System.out.println("----------------------------");
	    }
	}


}
